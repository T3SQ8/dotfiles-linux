#!/bin/sh

for file do
	noext=${file%.*}
	dirpath=${noext%/*}
	noext_nopath=${dirpath##*/}
	ext=${file##*.}
	case $ext in
		roff)
			groff -e -ms "$file" -Tpdf > "$noext.pdf" ;;
		tex)
			dir=$PWD
			file=$(realpath "$file")
			tmp=$(mktemp -d)
			cd "$tmp" || break
			{ pdflatex < "$file"
			{ [ -f "texput.bib" ] && biber texput && pdflatex < "$file" ;}
			pdflatex < "$file" ;} &&
			{ cd "$dir"; cp "$tmp/texput.pdf" "$noext_nopath.pdf" ;}
			rm -r "$tmp"
			;;

		md)
			pandoc "$file" -o "$noext.html" ;;
		c)
			gcc "$file" -o "$noext" ;;
		*)
			echo "$file: Unknown filetype" ;;
	esac
done
